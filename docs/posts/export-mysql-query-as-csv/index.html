<!DOCTYPE html>
<html lang="en">
    <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  <title>
    
    Exporting a MySQL query as CSV - Lambda Out Loud
    
  </title>

  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/assets/css/simple.min.css">
  <link rel="stylesheet" href="/assets/css/custom.css">

  <script data-goatcounter="https://lambda-out-loud.goatcounter.com/count" async src="https://gc.zgo.at/count.js"></script>

  
</head>

    <body class="post-template">
        <header>
	<div>
		<a href="/" class="site-title" title="Lambda Out Loud">Î»!</a>
		<p><em>A blog about all things code</em></p>
	</div>

	<nav>
		
		
		<a class=""
			href="/posts/">Posts
		 </a>
		
		<a class=""
			href="/grimoire/">Grimoire
		 </a>
		
		<a class=""
			href="/about/">About
		 </a>
		
	</nav>
</header>

        
<main>
    
    <h1>Exporting a MySQL query as CSV</h1>
    <p class="meta">
      <time >January 26, 2022</time>
    </p>
    <section>
      <p>I found this snippet on <a href="https://stackoverflow.com/a/5395421">StackOverflow</a> a
long time ago and have been thankfully using a slightly tweaked version of it
ever since. It exports the result of a database query to a CSV file, straight
from the commandline:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mysql -u &lt;user&gt; -p&lt;password&gt; &lt;database_name&gt; -e <span style="color:#4070a0">&#34;SELECT * FROM users&#34;</span> -B | sed <span style="color:#4070a0">&#34;s/&#39;/\&#39;/;s/\t/\&#34;,\&#34;/g;s/^/\&#34;/;s/</span>$<span style="color:#4070a0">/\&#34;/;s/\\\n/\n/g;s/\\\t/\t/g&#34;</span> &gt; export.csv
</code></pre></div><p>The result is a CSV file that opens just fine in LibreOffice, which you can then
use to convert it to an Excel file as needed.</p>
<h2 id="breaking-it-down">Breaking it down&nbsp;<a class="anchor" href="#breaking-it-down"><svg
            width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M14.8284 12L16.2426 13.4142L19.071 10.5858C20.6331 9.02365 20.6331 6.49099 19.071 4.9289C17.509 3.3668 14.9763 3.3668 13.4142 4.9289L10.5858 7.75732L12 9.17154L14.8284 6.34311C15.6095 5.56206 16.8758 5.56206 17.6568 6.34311C18.4379 7.12416 18.4379 8.39049 17.6568 9.17154L14.8284 12Z"
              fill="currentColor" />
            <path
              d="M12 14.8285L13.4142 16.2427L10.5858 19.0711C9.02372 20.6332 6.49106 20.6332 4.92896 19.0711C3.36686 17.509 3.36686 14.9764 4.92896 13.4143L7.75739 10.5858L9.1716 12L6.34317 14.8285C5.56212 15.6095 5.56212 16.8758 6.34317 17.6569C7.12422 18.4379 8.39055 18.4379 9.1716 17.6569L12 14.8285Z"
              fill="currentColor" />
            <path
              d="M14.8285 10.5857C15.219 10.1952 15.219 9.56199 14.8285 9.17147C14.4379 8.78094 13.8048 8.78094 13.4142 9.17147L9.1716 13.4141C8.78107 13.8046 8.78107 14.4378 9.1716 14.8283C9.56212 15.2188 10.1953 15.2188 10.5858 14.8283L14.8285 10.5857Z"
              fill="currentColor" />
          </svg></i></a> </h2>
<p>First, we connect to the database like we normally would:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mysql -u &lt;user&gt; -p&lt;password&gt; &lt;database_name&gt;
</code></pre></div><p>We then use <code>-e</code> to execute the given query directly. <code>-B</code> causes the query
output to be tab-separated instead of the normal table layout, as well as
escaping special characters like <code>\t</code> and <code>\n</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">-e <span style="color:#4070a0">&#34;SELECT * FROM users&#34;</span> -B
</code></pre></div><p>Finally, we use <code>sed</code> to convert the output to a proper CSV file:</p>
<pre tabindex="0"><code>s/'/\'/         Escape all single quotes
s/\t/\&quot;,\&quot;/     Replace all tabs with `&quot;,&quot;`
s/^/\&quot;/         Add a `&quot;` to the start of each line
s/$/\&quot;/         Add a `&quot;` to the end of each line
s/\\\n/\n/g     MySQL escapes \n in the output, so replace them again
s/\\\t/\t/g     Idem for \t
</code></pre><p>An alternative way to go about would be to use MySQL&rsquo;s <a href="https://stackoverflow.com/a/356605"><code>INTO OUTFILE</code></a>, but this requires specific
permissions.</p>

    </section>
    <p class="meta">
      Tags:
        <a href="https://www.lambda-out-loud.com/tags/mysql/">MySQL</a>, <a href="https://www.lambda-out-loud.com/tags/sql/">SQL</a>
    </p>
</main>

        <footer>
    &copy; 2022 Lambda Out Loud
    | <a href="mailto:mark.gerarts+lambda@gmail.com">Contact</a>
    | <a class="subscribe-button" href="/index.xml">RSS</a>
</footer>



    </body>
</html>
